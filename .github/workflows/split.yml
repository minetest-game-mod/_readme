
name: Split into separate mods
on:
#  schedule:
#    - 5 4 * * *
  push:
    branches:
      - master

jobs:
  split-the-repo:
    runs-on: ubuntu-latest
    env:
      token: ${{secrets.TOKEN}}
    steps:
      - name: Clone Self
        uses: actions/checkout@v2

      - name: Clone MTG
        run: git clone https://alek13:${{secrets.TOKEN}}@github.com/lord-server/minetest_game.git
#        uses: actions/checkout@v2
#        with:
#          repository: lord-server/minetest_game
#          path: minetest_game

      - name: Add Remotes
        run: |
          ./for-each 'git remote add mtg-mod-$dir https://alek13:${{secrets.TOKEN}}@github.com/minetest-game-mod/$dir.git'

      - name: Test check
        run: |
          cd minetest_game
          git status
          git remote -v
          cd ..

      - name: Separate Directories Push
        run: |
          cd minetest_game
          git checkout master
          cd ..
          ./for-each 'git subtree push -P mods/$dir mtg-mod-$dir master'
